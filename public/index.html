<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DansDan Dashboard</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f7f8fb;color:#222;text-align:center;padding:30px}
    .card{display:inline-block;background:#fff;padding:20px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.06);max-width:420px;width:92%}
    img{border-radius:8px;border:1px solid #ddd}
    .pair{font-weight:bold;color:green}
  </style>
</head>
<body>
  <h1>ðŸ¤– DansDan WhatsApp Bot</h1>
  <div class="card">
    <p id="status">Loading status...</p>
    <p>Pairing: <span id="pair" class="pair">âŒ› waiting</span></p>
    <div><img id="qr" src="/qr.png" width="240" alt="QR (if available)"></div>
    <form id="frm" style="margin-top:12px">
      <input id="phone" placeholder="e.g. 254712345678" style="padding:8px;width:68%" required>
      <button style="padding:8px 10px">Generate</button>
    </form>
  </div>

<script>
 async function refresh() {
  try {
    const res = await fetch('/status'); const data = await res.json();
    const s = data.connection || 'idle';
    const emoji = { connected:'ðŸŸ¢', reconnecting:'ðŸŸ¡', connecting:'ðŸŸ ', disconnected:'ðŸ”´', qr:'ðŸŸ¡', idle:'âšª', error:'âŒ' }[s]||'âšª';
    document.getElementById('status').innerText = `Status: ${emoji} ${s.toUpperCase()}`;
    const pairTxt = await (await fetch('/status')).json();
    const pairingFileRes = await fetch('/pairing.txt').catch(()=>null);
    if (pairingFileRes && pairingFileRes.ok) {
      const t = await pairingFileRes.text(); if (t) document.getElementById('pair').innerText = t;
    }
  } catch (e) {}
  document.getElementById('qr').src = '/qr.png?cache=' + Date.now();
 }
 setInterval(refresh, 5000); refresh();

 document.getElementById('frm').addEventListener('submit', async (e)=>{
   e.preventDefault();
   const phone = document.getElementById('phone').value.trim();
   await fetch('/generate', { method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded'}, body:`phone=${encodeURIComponent(phone)}`});
   setTimeout(refresh, 1500);
 });
</script>
</body>
</html>